{% extends 'base.html' %}

{% block title %}Карточки знаний - StudySense{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i class="fas fa-book me-2"></i>Карточки знаний
    </h1>
</div>

<!-- Фильтры -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <label for="subject" class="form-label">Предмет</label>
                <select name="subject" id="subject" class="form-select">
                    <option value="">Все предметы</option>
                    {% for subject in subjects %}
                        <option value="{{ subject.id }}" {% if request.GET.subject == subject.id|stringformat:"s" %}selected{% endif %}>
                            {{ subject.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="difficulty" class="form-label">Сложность</label>
                <select name="difficulty" id="difficulty" class="form-select">
                    <option value="">Все уровни</option>
                    <option value="1" {% if request.GET.difficulty == "1" %}selected{% endif %}>Начальный</option>
                    <option value="2" {% if request.GET.difficulty == "2" %}selected{% endif %}>Средний</option>
                    <option value="3" {% if request.GET.difficulty == "3" %}selected{% endif %}>Продвинутый</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-filter me-1"></i>Фильтровать
                </button>
                <a href="{% url 'knowledge_cards' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-1"></i>Сбросить
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Карточки -->
<div class="row">
    {% for card in cards %}
        <div class="col-md-4 mb-4">
            <div class="card card-hover h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="badge bg-primary">{{ card.subject.name }}</span>
                    <span class="badge bg-{{ card.difficulty_level|yesno:'success,warning,danger' }}">
                        {% if card.difficulty_level == 1 %}Начальный{% endif %}
                        {% if card.difficulty_level == 2 %}Средний{% endif %}
                        {% if card.difficulty_level == 3 %}Продвинутый{% endif %}
                    </span>
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ card.title }}</h5>
                    <p class="card-text text-muted">{{ card.simple_explanation|truncatewords:15 }}</p>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-chart-line me-1"></i>
                            Ваш прогресс: 
                            <span class="badge bg-{{ card.user_progress|yesno:'secondary,success,info,primary' }}">
                                {% if card.user_progress == 1 %}Не изучено{% endif %}
                                {% if card.user_progress == 2 %}В процессе{% endif %}
                                {% if card.user_progress == 3 %}Изучено{% endif %}
                                {% if card.user_progress == 4 %}Освоено{% endif %}
                            </span>
                        </small>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a href="{% url 'card_detail' card.id %}" class="btn btn-primary w-100">
                        <i class="fas fa-eye me-1"></i>Изучить
                    </a>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-book fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Карточки не найдены</h4>
                <p class="text-muted">Попробуйте изменить фильтры или добавьте новые карточки через админ панель.</p>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}
